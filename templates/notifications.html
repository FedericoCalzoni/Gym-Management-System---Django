{% extends 'base.html' %}
{% load static %}
{% block content %}
<main>
    <!-- Services -->
    <section class="container my-4">

        <div class="row">
            <div class="col-3">
                <div class="list-group">
                    <a href="{% url 'dashboard' %}" class="list-group-item">Dashboard</a>
                    <a href="#" class="list-group-item">Profile</a>
                    <a href="#" class="list-group-item">Messages</a>
                </div>
            </div>

            <div class="col-9">
                <h3 class="mb-4 border-bottom pb-1">Notifications <span class="badge bg-primary">123</span></h3>

                <span class="ajaxRes"> 

                </span>

                <ul class="list-group notif-list">
                    <!-- <li class="list-group-item bg-light">
                        This is a notification 1
                        <button class="btn btn-sm btn-secondary float-end">Mark as read</button>
                    </li>
                    <li class="list-group-item">
                        This is a notification 2
                        <i class="bi bi-check2-square text-success float-end"></i>
                    </li> -->
                    Loading...
                </ul>


            </div>
        </div>

    </section>
    <!-- End -->
</main>


<script type="text/javascript">
    $(document).ready(function(){
        $(".ajaxRes").hide();

        setInterval(function(){

            $.ajax({
                url:"{% url 'get_notifications' %}",
                dataType:'json',
                beforeSend:function(){
                    $(".ajaxRes").show();
                    $(".ajaxRes").text('loading...');
                },
                success:function(res){
                    _html='';
                    _json= $.parseJSON(res.notifications);
                    $.each(_json,function(index,d){

                        _html += '<li class="list-group-item bg-light">' +d.fields.notify_detail+'<button class="btn btn-sm btn-secondary float-end">Mark as read</button></li>';

                    });
                    $(".notif-list").html(_html);
                    $(".ajaxRes").hide();
                }
            });
        },5000);
    });
</script>

{% endblock %}
