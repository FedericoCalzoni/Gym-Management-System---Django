{% extends 'base.html' %}
{% load static %}
{% block content %}

<main>
    <section class="container my-4">

        <div class="row">
            <div class="col-3">
                {% include 'trainer/left_sidebar.html' %}
            </div>

            <div class="col-9">
                <h3 class="mb-4 border-bottom pb-1 text-center">Notifications  <span class="badge bg-info total_unread" style="position: relative; top: -3px; ">{{notifs.count}}</span></a></h3>

                <ul class="list-group notif-list">
                    {% for notification in notifications %}
                    <li class="list-group-item bg-light " data-id="{{ notification.id }}">
                        {{notification.notif_msg}}
                        <span class="btn btn-info btn-sm float-end">Mark as Read</span>
                    </li>
                    {% endfor %}
                </ul>


            </div>
        </div>

    </section>
    <!-- End -->
</main>

<script type="text/javascript">
    const Websocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/notifications/'
    );

    Websocket.onopen = function(){
        Websocket.send(JSON.stringify({
            'message': 'From Client'
        }));
    }

    Websocket.onmessage = function(event) {
        var _data = JSON.parse(event.data);
        
        if (_data.action === 'add') {
            // Add a new notification to the list
            $(".notif-list").prepend(
                '<li class="list-group-item" data-id="'+_data.notif_id+'">'
                + _data.notif + 
                '<span class="btn btn-info btn-sm float-end">Mark as Read</span>'
                + '</li>'
            );
        } else if (_data.action === 'delete') {
            // Remove the notification from the list based on its ID
            $(".notif-list").find("[data-id='" + _data.notif_id + "']").remove();
        }

        // Update the unread count
        $(".total_unread").text(_data.total);
    };
    Websocket.onclose = function(){
        console.log("closed");
    }

</script>

{% endblock %}
